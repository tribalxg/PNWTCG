# load data (assumes current working directory is top of 'PNWTCG' repo)
monitoring_locations <- read.table('./mapping/huc_from_gps/exdata.tsv', sep = '\t', header=TRUE)

# convert locations to sf object
sf_monitoring_locations <- sf::st_as_sf(monitoring_locations, coords = c("Long", "Lat"), crs=4326)

# subset Western Washington HUCs for speed improvement later
huc6s <- c('Coast' = '171001', 'Puget Sound' = '171100')
wwa <- nhdplusTools::get_huc(id = huc6s, type = 'huc06') # manually define the restricted search area
huc_lvl <- 'huc12'
wb_poly <- nhdplusTools::get_huc(sf::st_union(wwa), type = huc_lvl) # get_huc wants a single polygon, so st_union merges the two present in the wwa object

# rows in wb_poly are HUC polygons
# find indexes for the rows in wb_poly that contain the points in sf_monitoring_locations
wb_poly_idx <- sf::st_intersects(sf_monitoring_locations, wb_poly)

# convert wb_poly_idx to simpler vector object
wb_poly_idx <- unlist(wb_poly_idx)

# convert wb_poly to simpler data.frame object
wb_info <- as.data.frame(wb_poly)

# get the data from the corresponding rows and columns
huc_ids <- wb_info[wb_poly_idx, huc_lvl]
huc_names <- wb_info[wb_poly_idx, 'name']

# add IDs to original dataset
monitoring_locations[,'HUC12'] <- huc_ids

# or to the sf version
sf_monitoring_locations[,'HUC12'] <- huc_ids
